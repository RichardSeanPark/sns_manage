# 테스트 케이스: RSS 피드 수집 모듈

## 기본 정보
- **모듈**: app.collector.rss_collector
- **테스트 유형**: 단위
- **작성자**: AI Assistant
- **마지막 업데이트**: 2024-04-07

## 테스트 케이스 목록

### TC-001: HTML 정리 기능 테스트 (_clean_html)
- **설명**: HTML 콘텐츠에서 태그를 제거하고 텍스트만 추출하며 공백을 정리하는 기능 테스트
- **사전 조건**: RSSCollector 클래스가 구현되어 있어야 함
- **테스트 단계**:
  1. 다양한 HTML 문자열(태그 포함, 빈 문자열, None) 생성
  2. _clean_html 메서드 호출
  3. 결과 검증
- **예상 결과**: HTML 태그가 제거되고 정제된 텍스트만 반환됨 (선행/후행/중복 공백 제거)
- **실제 결과**:
- **상태**: [x] 통과 [ ] 실패 [ ] 보류
- **메모**: BeautifulSoup 의존성 있음. TC-012와 통합 가능성 있음.

### TC-002: 모든 피드 수집 기능 테스트 (fetch_all_feeds)
- **설명**: 여러 RSS 피드 소스에서 기사를 수집하고, 중복 제거 및 저장 함수를 호출하는 기능 테스트
- **사전 조건**: RSSCollector 클래스가 구현되어 있어야 함
- **테스트 단계**:
  1. fetch_feed, _remove_duplicates, _save_feeds 메서드를 모킹
  2. fetch_all_feeds 메서드 호출
  3. 각 모킹된 메서드가 예상대로 호출되었는지, 최종 반환값이 올바른지 검증
- **예상 결과**: 설정된 모든 피드 소스에 대해 fetch_feed가 호출되고, 반환된 결과가 중복 제거 및 저장 함수로 전달되며, 최종적으로 중복 제거된 아이템 목록이 반환됨
- **실제 결과**:
- **상태**: [x] 통과 [ ] 실패 [ ] 보류
- **메모**: 내부 메서드 호출 순서 및 데이터 흐름 확인

### TC-003: 중복 제거 기능 테스트 (_remove_duplicates)
- **설명**: FeedItem 리스트에서 URL 기반으로 중복된 아이템을 제거하는 기능 테스트
- **사전 조건**: RSSCollector 클래스가 구현되어 있어야 함
- **테스트 단계**:
  1. 중복된 URL을 포함하는 FeedItem 리스트 생성
  2. _remove_duplicates 메서드 호출
  3. 결과 검증 (개수, 남은 아이템 확인)
- **예상 결과**: URL이 동일한 아이템은 첫 번째 아이템만 남고 나머지는 제거됨
- **실제 결과**:
- **상태**: [x] 통과 [ ] 실패 [ ] 보류
- **메모**: 중복 제거 시 순서 유지 확인

### TC-004: 피드 저장 기능 테스트 (_save_feeds)
- **설명**: 수집된 피드 아이템 리스트를 JSON 파일로 저장하는 기능 테스트
- **사전 조건**: RSSCollector 클래스가 구현되어 있어야 함
- **테스트 단계**:
  1. 테스트용 FeedItem 리스트 생성
  2. 임시 디렉토리 설정
  3. open 및 json.dump를 모킹하지 않고 실제 파일 쓰기 수행 (임시 디렉토리 사용)
  4. _save_feeds 메서드 호출
  5. 생성된 파일 존재 여부 및 내용 검증
- **예상 결과**: 지정된 경로에 FeedItem 리스트가 JSON 형식으로 저장된 파일이 생성됨
- **실제 결과**:
- **상태**: [x] 통과 [ ] 실패 [ ] 보류
- **메모**: 실제 파일 I/O 테스트로 변경

### TC-005: 피드 소스 로딩 및 검증 테스트
- **설명**: 설정 파일(예: config.py)에서 RSS_SOURCES를 로드하고 각 소스의 유효성을 검증하는 테스트
- **사전 조건**: 설정 파일 및 RSS_SOURCES 정의 필요
- **테스트 단계**:
  1. RSSCollector 인스턴스 생성 (feed_sources 미지정)
  2. collector.feed_sources가 설정 파일의 내용과 일치하는지 확인
  3. 각 source 딕셔너리가 필요한 키(name, url, category 등)를 포함하고 타입이 올바른지 검증
- **예상 결과**: 설정 파일의 RSS_SOURCES가 올바르게 로드되고 각 소스 정보가 유효함
- **실제 결과**:
- **상태**: [x] 통과 [ ] 실패 [ ] 보류
- **메모**: config.py 또는 관련 설정 모듈 로딩 필요

### TC-006: 잘못된 피드 URL 처리 테스트 (fetch_feed)
- **설명**: 존재하지 않거나 잘못된 형식의 URL로 피드 수집 시도 시 에러 처리 테스트
- **사전 조건**: RSSCollector 클래스 구현, feedparser.parse 모킹 필요
- **테스트 단계**:
  1. feedparser.parse가 네트워크 오류 또는 빈 결과를 반환하도록 모킹 설정
  2. 잘못된 URL을 가진 source 딕셔너리로 fetch_feed 호출
  3. 로깅 (에러 또는 경고) 발생 여부 확인
  4. 빈 리스트가 반환되는지 확인
- **예상 결과**: 오류가 로깅되고 빈 리스트가 반환됨
- **실제 결과**:
- **상태**: [x] 통과 [ ] 실패 [ ] 보류
- **메모**: 네트워크 요청 모의 필요 (requests 또는 feedparser 레벨)

### TC-007: 피드 카테고리 할당 테스트 (fetch_feed)
- **설명**: 피드 수집 시 FeedItem 객체에 올바른 source_category가 할당되는지 테스트
- **사전 조건**: RSSCollector 클래스 구현, feedparser.parse 모킹 필요
- **테스트 단계**:
  1. feedparser.parse가 정상적인 피드 데이터를 반환하도록 모킹 설정
  2. 특정 카테고리를 가진 source 딕셔너리로 fetch_feed 호출
  3. 반환된 FeedItem 객체들의 source_category 속성이 source 딕셔너리의 값과 일치하는지 확인
- **예상 결과**: FeedItem의 source_category가 정확히 할당됨
- **실제 결과**:
- **상태**: [x] 통과 [ ] 실패 [ ] 보류
- **메모**: TC-008과 통합 가능

### TC-008: 단일 피드 수집 성공 테스트 (fetch_feed)
- **설명**: 정상적인 RSS 피드로부터 여러 항목을 성공적으로 수집하는 기능 테스트
- **사전 조건**: RSSCollector 클래스 구현, feedparser.parse 모킹 필요
- **테스트 단계**:
  1. feedparser.parse가 여러 entry를 포함한 정상 피드 데이터를 반환하도록 모킹 설정
  2. fetch_feed 호출
  3. 반환된 FeedItem 리스트의 개수 및 각 아이템의 기본 필드(title, link 등) 검증
- **예상 결과**: 피드의 모든 유효한 항목이 FeedItem 객체 리스트로 변환되어 반환됨
- **실제 결과**:
- **상태**: [x] 통과 [ ] 실패 [ ] 보류
- **메모**: 상세 필드 검증은 다른 테스트 케이스(TC-011, TC-012, TC-013)에서 수행

### TC-009: 단일 피드 수집 (빈 피드) 테스트 (fetch_feed)
- **설명**: 항목(entry)이 없는 빈 RSS 피드 처리 테스트
- **사전 조건**: RSSCollector 클래스 구현, feedparser.parse 모킹 필요
- **테스트 단계**:
  1. feedparser.parse가 entries가 비어있는 피드 데이터를 반환하도록 모킹 설정
  2. fetch_feed 호출
  3. 빈 리스트가 반환되는지 확인
- **예상 결과**: 빈 리스트 반환
- **실제 결과**:
- **상태**: [x] 통과 [ ] 실패 [ ] 보류
- **메모**:

### TC-010: 단일 피드 수집 (파싱 오류) 테스트 (fetch_feed)
- **설명**: 잘못된 형식의 RSS 피드 데이터 파싱 시 오류 처리 테스트
- **사전 조건**: RSSCollector 클래스 구현, feedparser.parse 모킹 필요
- **테스트 단계**:
  1. feedparser.parse가 bozo=1이고 entries가 없는 피드 데이터를 반환하도록 모킹 설정
  2. fetch_feed 호출
  3. 로깅 (경고) 발생 여부 확인
  4. 빈 리스트가 반환되는지 확인
- **예상 결과**: 경고 로그 발생 및 빈 리스트 반환
- **실제 결과**:
- **상태**: [x] 통과 [ ] 실패 [ ] 보류
- **메모**: feedparser의 bozo 플래그 활용

### TC-011: 날짜 파싱 테스트 (_parse_date)
- **설명**: 다양한 형식의 날짜 필드(published_parsed, updated_parsed 등)를 올바르게 파싱하여 datetime 객체로 변환하는 기능 테스트
- **사전 조건**: RSSCollector 클래스 구현
- **테스트 단계**:
  1. 다양한 날짜 필드를 가진 feedparser entry 모의 객체 생성
  2. _parse_date 메서드 호출
  3. 반환된 datetime 객체가 예상 값과 일치하는지 확인
  4. 날짜 필드가 없는 경우 현재 시간이 반환되는지 확인
- **예상 결과**: 각 케이스에 맞는 정확한 datetime 객체 반환
- **실제 결과**:
- **상태**: [x] 통과 [ ] 실패 [ ] 보류
- **메모**: time.struct_time 형식 처리 확인

### TC-012: 콘텐츠 추출 및 정리 테스트 (_extract_content)
- **설명**: feedparser entry에서 content 또는 summary 필드를 추출하고 HTML을 정리하여 본문 텍스트를 얻는 기능 테스트
- **사전 조건**: RSSCollector 클래스 구현
- **테스트 단계**:
  1. content 필드(HTML 포함), summary 필드, 둘 다 없는 entry 모의 객체 생성
  2. _extract_content 메서드 호출
  3. 반환된 문자열이 예상대로 정제된 텍스트인지 확인 (TC-001의 _clean_html 활용)
- **예상 결과**: content 또는 summary에서 추출되고 정제된 텍스트 반환, 둘 다 없으면 빈 문자열 반환
- **실제 결과**:
- **상태**: [x] 통과 [ ] 실패 [ ] 보류
- **메모**: TC-001 (_clean_html) 테스트와 연계됨

### TC-013: 태그 추출 테스트 (_extract_tags)
- **설명**: feedparser entry의 tags 또는 categories 필드에서 태그/카테고리 목록을 추출하는 기능 테스트
- **사전 조건**: RSSCollector 클래스 구현
- **테스트 단계**:
  1. tags 필드, categories 필드(다양한 형식 포함), 둘 다 없는 entry 모의 객체 생성
  2. _extract_tags 메서드 호출
  3. 반환된 태그 리스트가 예상 값과 일치하는지 확인 (중복 제거 포함)
- **예상 결과**: entry의 태그와 카테고리가 중복 없이 문자열 리스트로 추출됨
- **실제 결과**:
- **상태**: [x] 통과 [ ] 실패 [ ] 보류
- **메모**: feedparser의 다양한 태그/카테고리 형식 처리 확인

### TC-014: 피드 요청 오류 처리 테스트 (fetch_feed)
- **설명**: 피드 URL 요청 시 발생하는 네트워크 오류(타임아웃, 연결 거부 등) 처리 테스트
- **사전 조건**: RSSCollector 클래스 구현, feedparser.parse 모킹 필요
- **테스트 단계**:
  1. feedparser.parse가 requests.exceptions.RequestException 또는 Timeout 예외를 발생시키도록 모킹 설정
  2. fetch_feed 호출
  3. 로깅 (에러) 발생 여부 확인
  4. 빈 리스트가 반환되는지 확인
- **예상 결과**: 에러 로그 발생 및 빈 리스트 반환
- **실제 결과**:
- **상태**: [x] 통과 [ ] 실패 [ ] 보류
- **메모**: 네트워크 관련 예외 처리 확인 